const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BNM2Gi5R.js","assets/index-C5uZTJKy.css"])))=>i.map(i=>d[i]);
import{$ as re,aw as le,Y as ie,aL as oe,ay as ce,ap as me,r as m,an as de,aM as o,aB as I,aC as F,aN as ue,aO as i,aP as K,aQ as y,aR as ge,aG as ve,a4 as a,a5 as pe,aS as fe,aT as Ee,ao as z,aU as he,aV as P,aW as b,aX as M,aY as ye}from"./index-BNM2Gi5R.js";import{F as Ne,Q as _e,o as we,M as Se,Y as Ce,T as Te}from"./index-DI-oUhNR.js";import{E as Ae}from"./chunk-XE7R4DL5-DHM2H5_t.js";import{p as ke}from"./chunk-TT34D6R6-rAh4iaYe.js";import"./colors-DKL_4IUq.js";import"./chunk-YNAB6HVU-Cz67zcwW.js";import"./index-BqT3UfUb.js";var Ie="ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",Pe={async findAssociatedTokenAddress(N,r){let{PublicKey:l}=await he(()=>import("./index-BNM2Gi5R.js").then(p=>p.fK),__vite__mapDeps([0,1])),_=new l("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA");return l.findProgramAddressSync([new l(N).toBuffer(),_.toBuffer(),new l(r).toBuffer()],new l(Ie))[0]}},V=Pe;function be(N){let{method:r,param:l,chainId:_,loginAuthorizationSign:p}=N,{t}=re(),w=le(),{setPaymentVerify:q,userInfo:d,setPaymentPassword:D}=ie(),{events:S}=oe(),{modalOptions:R}=ce(),{authCoreModal:W}=me(),{errorHandle:Q}=Ae(),[B,C]=m.useState(!1),O=de(),[u,J]=m.useState(),[L,Y]=m.useState(),[U,Z]=m.useState(),[j,f]=m.useState(""),[H,E]=m.useState(""),{hasSetPaymentPassword:T,showSetPaymentPasswordOrConfirm:X}=Ne(),g=m.useMemo(()=>({id:_||o.solana.chainId,name:"Solana"}),[]),ee=m.useMemo(()=>{let n=o.solana.selectedAddress;return I(n)},[]);m.useEffect(()=>{F().catch(n=>{}),ue()&&w("account/master-password/verify")},[w]);let ae=()=>{F().then(()=>{x()}).catch(n=>{var e;C(!1),O.error((e=n.message)!=null?e:"Sign Error")})},G=(n,e)=>{S.emit("signResponse",{result:n,error:e})};async function $(n,e){if(!e)return[];let s=await Promise.all(e.map(n));return e.filter((v,c)=>s[c])}let x=async()=>{var n,e;!r||(b({record_type:M.PAGE_SIGN_CONFIRM_BUTTON_CLICK}),(n=d?.security_account)!=null&&n.has_set_payment_password?q({visible:!0,onVerifyCompleted:A}):r===i.signAndSendTransaction||r===i.signTransaction||r===i.signAllTransactions||((e=R?.promptSettingConfig)==null?void 0:e.promptPaymentPasswordSettingWhenSign)===3?X(A):A())},A=async()=>{var n;if(!r)return;C(!0);let e;try{if(r===i.signMessage){let{signature:s}=await o.solana.signMessage(l);e=s}else if(r===i.signAndSendTransaction){let{signature:s}=await o.solana.signAndSendTransaction(l,g.id);e=s}else if(r===i.signTransaction)e=await o.solana.signTransaction(l,g.id);else if(r===i.signAllTransactions)e=await o.solana.signAllTransactions(l,g.id);else throw new Error("Unknown method");b({record_type:M.PAGE_SIGN_CONFIRM_BUTTON_CLICK_SUCCESS})}catch(s){b({record_type:M.PAGE_SIGN_CONFIRM_BUTTON_CLICK_FAILURE}),s?.error_code===50103&&!((n=d?.security_account)!=null&&n.has_set_payment_password)?ae():s?.message==="Local Key not found"||s?.message==="Master password decryption error"?w("account/master-password/verify"):Q(s)}finally{C(!1)}e&&(r===i.signMessage&&p?S.emit("loginSuccess",{...d,authorization:{message:y.encode(l),signature:e}}):G(e))},se=()=>{B||(p?S.emit("loginSuccess",d):G(void 0,ye.userRejectedRequest()))};m.useEffect(()=>{if(r===i.signMessage)f(t("sign.signature_message")),E(t("sign.signature_title"));else if(r===i.signAndSendTransaction){f(t("sign.send_transaction")),E(t("sign.approve_and").format(K(g)));let n=l.serialize({requireAllSignatures:!1,verifySignatures:!1});h([y.encode(n)])}else if(r===i.signTransaction){f(t("sign.sign_transaction")),E(t("sign.sign_but"));let n=l.serialize({requireAllSignatures:!1,verifySignatures:!1});h([y.encode(n)])}else if(r===i.signAllTransactions){f(t("sign.sign_transaction")),E(t("sign.sign_but"));let n=l.map(e=>y.encode(e.serialize({requireAllSignatures:!1,verifySignatures:!1})));h(n)}else throw new Error("Unknown method")},[l,t]),m.useEffect(()=>{o.solana.connect()},[]);let h=n=>{o.solana.request({chainId:g.id,method:ge.enhancedDeserializeTransaction,params:n}).then(e=>{var s,v;J(e),$(async c=>{let k=await V.findAssociatedTokenAddress(o.solana.selectedAddress,c.mint);return c.associatedTokenAddress===k.toBase58()},(s=e?.estimatedChanges)==null?void 0:s.nfts).then(c=>{Y(c)}),$(async c=>{let k=await V.findAssociatedTokenAddress(o.solana.selectedAddress,c.mint);return c.associatedTokenAddress===k.toBase58()},(v=e?.estimatedChanges)==null?void 0:v.tokens).then(c=>{Z(c)})}).catch(e=>{var s;ve.error({title:(s=e.message)!=null?s:"Deserialize Transaction Error",okCancel:!0,cancelText:t("common.cancel"),okText:t("common.retry"),wrapClassName:"auth-core-modal-error",getContainer:()=>W.rootBody,onOk:()=>{h(n)}})})},ne=()=>{let n=new TextDecoder().decode(l);return a.createElement("div",{className:"sign-message"},a.createElement("div",{className:"message"+(T?"":" no-password-tip")},a.createElement("div",{className:"pre-wrap personal-message"},n)))},te=()=>{var n;return a.createElement(Te,{defaultActiveKey:"1",items:[{label:t("sign.details"),key:"1",children:a.createElement(a.Fragment,null,a.createElement("div",{className:"balance-change"},a.createElement("div",{className:"title"},t("sign.estimated_balance_change")),a.createElement("div",{className:"change-body"},(n=u?.estimatedChanges)==null?void 0:n.sols.filter(e=>{var s,v;return e.address===((v=(s=o)==null?void 0:s.solana)==null?void 0:v.selectedAddress)}).map((e,s)=>a.createElement("div",{className:"change-title",key:`sol-change-${s}`},"SOL",a.createElement("div",{className:"change-val",style:e.lamportsChange<0?{color:"#ea4335"}:{}},e.lamportsChange<0?"":"+",P(e.lamportsChange,9)))),L?.map((e,s)=>a.createElement("div",{className:"change-title",key:`nft-change-${s}`},e.name?e.name:"Unknown NFT",a.createElement("div",{className:"change-val",style:e.amountChange<0?{color:"#ea4335"}:{}},e.amountChange<0?"":"+",e.amountChange))),U?.map((e,s)=>a.createElement("div",{className:"change-title",key:`token-change-${s}`},e.name?e.name:"Unknown Token",a.createElement("div",{className:"change-val",style:e.amountChange<0?{color:"#ea4335"}:{}},e.amountChange<0?"":"+",P(e.amountChange,e.decimals)))))),a.createElement("div",{className:"net-fee solana"},a.createElement("div",{className:"title"},t("sign.network_fee"),u&&a.createElement("div",{className:"fee-val"},P(u.estimatedLamportsFee,9)," SOL"))))},{label:t("sign.data"),key:"2",children:a.createElement("div",null,u?.instructions.map((e,s)=>a.createElement("div",{className:"inner-instruction",key:`instruction-${s}`},a.createElement("div",{className:"inner-content"},a.createElement("div",{className:"content-item"},a.createElement("div",{className:"item"},a.createElement("div",{className:"item-0"},"#",s+1," - ",t(`program.${e.type}`)),a.createElement("div",{className:"item-1 mt10"},t("sign.program_id"),a.createElement("span",null,I(e.programId))),a.createElement("div",{className:"item-1 mt15"},t("sign.data"),a.createElement("span",null,I(e.data)))))))))}]})};return a.createElement("div",{className:"info-sign"},a.createElement("style",null,pe(_e)),!T&&a.createElement("div",{className:"has-payment-password","data-telegram":fe()},a.createElement("div",{className:"has-payment-password-icon"}),a.createElement("div",{className:"has-payment-password-tip"},t("account.waring_tip1")),a.createElement("div",{className:"has-payment-password-set",onClick:D},t("account.set"))),a.createElement("div",{className:"scroll-part"+(T?"":" no-password-tip")},a.createElement(we,{userInfo:d,transactionInfo:u}),a.createElement("div",{className:"info-request"},j),a.createElement("div",{className:"info-title"},a.createElement("img",{src:Ee(g),alt:""}),K(g)),a.createElement(Se,{text:o.solana.selectedAddress,onCopy:()=>O.success(t("new.copied_to"))},a.createElement("div",{className:"info-address"},ee,a.createElement("div",{className:"copy-icon"},a.createElement(Ce,null)))),a.createElement("div",{className:"info-des"},H),a.createElement("div",{className:"apart-line"}),r===i.signMessage&&ne(),r!==i.signMessage&&te()),a.createElement("div",{className:"btn-box"},a.createElement("div",null,a.createElement(z,{className:"btn-cancel",onClick:se},t("common.cancel")),a.createElement(z,{className:"btn-approve",onClick:x,loading:B},t("common.confirm"))),a.createElement(ke,null)))}var $e=be;export{$e as default};
